*** ConnectivityService.smali	2014-08-15 13:38:40.264256390 +0800
--- ConnectivityService.smali	2014-08-15 13:40:42.796259672 +0800
***************
*** 6727,6732 ****
      move-result v8
  
      .local v8, usedNetworkType:I
      iget-object v10, p0, Lcom/android/server/ConnectivityService;->mNetTrackers:[Landroid/net/NetworkStateTracker;
  
      aget-object v6, v10, v8
--- 6729,6740 ----
      move-result v8
  
      .local v8, usedNetworkType:I
+     invoke-static {}, Lmiui/net/FirewallManager;->getInstance()Lmiui/net/FirewallManager;
+ 
+     move-result-object v10
+ 
+     invoke-virtual {v10, v7, v5, v8}, Lmiui/net/FirewallManager;->onStopUsingNetworkFeature(III)V
+ 
      iget-object v10, p0, Lcom/android/server/ConnectivityService;->mNetTrackers:[Landroid/net/NetworkStateTracker;
  
      aget-object v6, v10, v8
***************
*** 10172,10177 ****
      :try_end_0
      .catchall {:try_start_0 .. :try_end_0} :catchall_0
  
      if-ltz v10, :cond_8
  
      move-object/from16 v0, p0
--- 10180,10199 ----
      :try_end_0
      .catchall {:try_start_0 .. :try_end_0} :catchall_0
  
+     invoke-static {}, Lmiui/net/FirewallManager;->getInstance()Lmiui/net/FirewallManager;
+ 
+     move-result-object v13
+ 
+     invoke-static {}, Lcom/android/server/ConnectivityService;->getCallingUid()I
+ 
+     move-result v14
+ 
+     invoke-static {}, Lcom/android/server/ConnectivityService;->getCallingPid()I
+ 
+     move-result v15
+ 
+     invoke-virtual {v13, v14, v15, v12}, Lmiui/net/FirewallManager;->onStartUsingNetworkFeature(III)V
+ 
      if-ltz v10, :cond_8
  
      move-object/from16 v0, p0
